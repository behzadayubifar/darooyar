# دارویار API Server

This is the API server for the دارویار (Darooyar) prescription analysis application. It provides endpoints for analyzing prescription text and images.

## Getting Started

### Prerequisites

- Go 1.16 or higher
- Git
- OpenAI API Key (for AI-powered features)
- Liara Storage Account (for image storage)

### Installation

1. Clone the repository:

   ```
   git clone https://github.com/yourusername/darooyar.git
   cd darooyar/server
   ```

2. Install dependencies:

   ```
   go mod download
   ```

3. Set up environment variables:

   Create a `.env` file in the server directory with the following content:

   ```
   OPENAI_API_KEY=your_openai_api_key_here
   LIARA_ACCESS_KEY=your_liara_access_key_here
   LIARA_SECRET_KEY=your_liara_secret_key_here
   LIARA_ENDPOINT=your_liara_endpoint_here
   LIARA_BUCKET_NAME=your_bucket_name_here
   ```

   Replace the placeholder values with your actual API keys and configuration.

4. Run the server:
   ```
   go run main.go
   ```

The server will start on port 8080.

## API Endpoints

### Health Check

```
GET /api/health
```

Returns the status of the API server.

### Chat Image Upload

```
POST /api/chats/{id}/messages/image
Content-Type: multipart/form-data

Form fields:
- image: The image file to upload
- role: The role of the message sender (defaults to "user")
```

Uploads an image to Liara storage and creates a message with the image URL.

### Analyze Prescription Text

```
POST /api/analyze-prescription/text
Content-Type: application/json

{
  "text": "Your prescription text here"
}
```

Returns an analysis of the prescription text.

### Analyze Prescription Image

```
POST /api/analyze-prescription/image
Content-Type: multipart/form-data

Form field: image (file)
```

Returns an analysis of the prescription image.

### AI-Powered Text Completion

```
POST /api/ai/completion
Content-Type: application/json

{
  "prompt": "Your prompt here"
}
```

Returns a completion generated by the OpenAI API.

### AI-Powered Prescription Analysis

```
POST /api/ai/analyze-prescription
Content-Type: application/json

{
  "text": "Your prescription text here"
}
```

Returns an AI-powered analysis of the prescription text using OpenAI.

## Development

### Project Structure

- `main.go`: Entry point of the application
- `handlers/`: Contains API endpoint handlers
- `models/`: Contains data models
- `storage/`: Contains storage-related code (S3/Liara)

### Adding New Features

1. Define new models in the `models/` directory
2. Create new handlers in the `handlers/` directory
3. Register new routes in `main.go`

### OpenAI Integration

The server uses the OpenAI API for AI-powered features. The integration is implemented in the `handlers/ai.go` file. To use these features, you need to:

1. Get an API key from OpenAI: https://platform.openai.com/
2. Set the API key in the `.env` file
3. Use the AI-powered endpoints

### Liara Storage Integration

The server uses Liara's S3-compatible storage for image uploads. To use this feature:

1. Create a Liara storage account
2. Create a bucket for storing images
3. Get your access key, secret key, and endpoint URL
4. Set the configuration in the `.env` file
5. Use the image upload endpoints

## License

This project is licensed under the Creative Commons Attribution-NonCommercial 4.0 International License - see the [LICENSE](../LICENSE) file for details.

This means you are free to:

- Share — copy and redistribute the material in any medium or format
- Adapt — remix, transform, and build upon the material

Under the following terms:

- Attribution — You must give appropriate credit, provide a link to the license, and indicate if changes were made.
- NonCommercial — You may not use the material for commercial purposes.
